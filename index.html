<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üß† Strain Game</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
  input, button { font-size: 1rem; padding: 0.5rem; margin: 0.3rem 0; }
  #usernameInput { width: 100%; max-width: 300px; }
  #wordInput { width: 100%; max-width: 200px; }
  #wordList { margin-top: 1rem; padding-left: 20px; }
  #yesterdaySection { margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem; }
</style>
  <style>
  .how-to-play-button {
  position: absolute;
  top: 20px;
  right: 20px;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #444;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 1000;
}

.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 500px;
  position: relative;
}

.close-button {
  color: #aaa;
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}
.close-button:hover {
  color: black;
}
    </style>

</head>
<body>

<h1>üß† Strain Game</h1>
  <!-- How to Play Button -->
<button id="howToPlayBtn" class="how-to-play-button">How to Play</button>

<!-- How to Play Modal -->
<div id="howToPlayModal" class="modal">
  <div class="modal-content">
    <span class="close-button" id="closeHowToPlay">&times;</span>
    <h2>How to Play</h2>
    <li>Start with the given <em>Start</em> word and try to reach the <em>End</em> word.</li>
    <li>Change only one letter at a time to form a new valid English word.</li>
    <li>Each word must be different from all previous words in the chain.</li>
  </ul>
  <strong class="block mt-4">Example:</strong>
  <p><em>cold ‚Üí cord ‚Üí card ‚Üí ward ‚Üí warm</em></p>
  </div>
</div>

<label for="usernameInput">Enter your name:</label>
<input type="text" id="usernameInput" placeholder="Your name" maxlength="20" />

<div id="game">
  <!-- Game UI will be loaded here -->
</div>

<div id="controls" style="margin-top: 1rem;">
  <button onclick="hintbtn()">üí° Hint (-3 points)</button>
  <button onclick="loadGame()">üîÅ Restart</button>
  <button onclick="loadYesterday()">üìÖ Yesterday's Puzzle</button>
  <button onclick="showLeaderboard()">üèÜ Leaderboard</button>
  <button onclick="generateChallengeLink()">üéØ Challenge a Friend</button>
</div>

<div id="yesterdaySection">
  <h3>Yesterday's Puzzle</h3>
  <div id="yesterdayInfo">Loading...</div>
  <button id="loadYesterdayBtn">Load Yesterday's Game</button>
</div>

<textarea id="share-output" readonly rows="4" style="width:100%; margin-top:1rem;"></textarea>
<button onclick="copyToClipboard(document.getElementById('share-output').value)">üì§ Copy Shareable Result</button>

<script>
// --- Utilities ---

function getTodayDateKey(offset = 0) {
  const today = new Date();
  today.setDate(today.getDate() + offset);
  return today.toISOString().split("T")[0];
}

function saveGameResult(dateKey, result) {
  localStorage.setItem(`result-${dateKey}`, JSON.stringify(result));
}

function getGameResult(dateKey) {
  return JSON.parse(localStorage.getItem(`result-${dateKey}`));
}

function updateStreak() {
  const today = getTodayDateKey();
  const yesterday = getTodayDateKey(-1);
  const yesterdayResult = getGameResult(yesterday);
  let streak = parseInt(localStorage.getItem("streak") || "0");

  if (yesterdayResult && !getGameResult(today)) {
    streak++;
  } else if (!yesterdayResult) {
    streak = 1;
  }
  localStorage.setItem("streak", streak);
  // Optionally update streak display if added to UI
}

function addLeaderboardEntry(name, guesses, time) {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  leaderboard.push({ name, guesses, time });
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

function showLeaderboard() {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  if (leaderboard.length === 0) {
    alert("No leaderboard entries yet.");
    return;
  }
  leaderboard.sort((a, b) => a.time - b.time);
  const list = leaderboard.map(e => `${e.name}: ${e.guesses} guesses, ${e.time}s`).join("\n");
  alert("üèÜ Leaderboard:\n" + list);
}

function generateShareText(result) {
  const emojiMap = ["‚¨õÔ∏è", "üü®", "üü©"];
  const lines = result.path.map(word => {
    return word.split("").map(() => emojiMap[Math.floor(Math.random() * 3)]).join("");
  });
  lines.push(`üéâ Solved in ${result.path.length} guesses!`);
  lines.push("Play: https://MattyBoy22.github.io/strain-game/");
  return lines.join("\n");
}

function copyToClipboard(text) {
  if (!text) return alert("Nothing to copy!");
  navigator.clipboard.writeText(text);
  alert("üìã Result copied to clipboard!");
}

// --- Game logic ---

const usernameInput = document.getElementById("usernameInput");
let playerName = localStorage.getItem("playerName") || "";
usernameInput.value = playerName;

usernameInput.addEventListener("keyup", (e) => {
  if (e.key === "Enter") {
    const name = usernameInput.value.trim();
    if (name.length === 0) {
      alert("Please enter a valid name");
      return;
    }
    playerName = name;
    localStorage.setItem("playerName", playerName);
    alert(`Username set to: ${playerName}`);
  }
});

function loadPuzzle(dateKey = getTodayDateKey()) {
  // Check for custom puzzle params here if needed

  const wordPairs = [
    ["stain", "brain"],
    ["start", "crate"],
    ["plant", "grape"],
    ["sword", "stone"],
    ["chair", "table"]
  ];
  const seed = new Date(dateKey).getDate() % wordPairs.length;
  return { dateKey, start: wordPairs[seed][0], end: wordPairs[seed][1] };
}

function loadYesterday() {
  loadGame(getTodayDateKey(-1));
}

function loadGame(dateKey = getTodayDateKey()) {
  const puzzle = loadPuzzle(dateKey);
  const gameEl = document.getElementById("game");
  gameEl.innerHTML = `
    <p>Transform <b>${puzzle.start}</b> ‚Üí <b>${puzzle.end}</b> one letter at a time</p>
    <input id='wordInput' maxlength="5" placeholder="Enter 5-letter word" />
    <button onclick='submitWord()'>Submit</button>
    <ul id='wordList'></ul>
  `;

  const inputEl = document.getElementById("wordInput");
  inputEl.focus();
  inputEl.addEventListener("keyup", function (e) {
    if (e.key === "Enter") submitWord();
  });

  const path = [];
  const start = puzzle.start;
  const end = puzzle.end;

  function isOneLetterDifferent(w1, w2) {
    if (w1.length !== w2.length) return false;
    let diff = 0;
    for (let i = 0; i < w1.length; i++) if (w1[i] !== w2[i]) diff++;
    return diff === 1;
  }

  window.submitWord = function () {
    const word = inputEl.value.trim().toLowerCase();
    if (path.length === 0 && word !== start) return alert("Start with the first word: " + start);
    if (!/^[a-zA-Z]{5}$/.test(word)) return alert("Word must be exactly 5 letters");
    if (path.length > 0 && !isOneLetterDifferent(path[path.length - 1], word)) return alert("Change exactly one letter");
    path.push(word);
    const wordListEl = document.getElementById("wordList");
    wordListEl.innerHTML += `<li>${word}</li>`;
    inputEl.value = "";
    inputEl.focus();

    if (word === end) {
      const result = { dateKey: puzzle.dateKey, path };
      saveGameResult(puzzle.dateKey, result);
      updateStreak();
      addLeaderboardEntry(playerName || "Anonymous", path.length, path.length * 5);
      document.getElementById("share-output").value = generateShareText(result);
      alert("üéâ You solved it! Results ready to share.");
    }
  };

  updateStreak();
}

if (!confirm("Using a hint will deduct 3 points. Are you sure?")) return;


// Yesterday's Puzzle Section
function displayYesterday() {
  const yesterdayKey = getTodayDateKey(-1);
  const yesterdayResult = getGameResult(yesterdayKey);
  const yesterdayInfo = document.getElementById("yesterdayInfo");

  if (!yesterdayResult) {
    yesterdayInfo.textContent = "You did not play yesterday‚Äôs puzzle.";
  } else {
    yesterdayInfo.innerHTML = `
      Puzzle Date: ${yesterdayKey}<br>
      Guesses: ${yesterdayResult.path.length}<br>
      Words: ${yesterdayResult.path.join(", ")}
    `;
  }
}

document.getElementById("loadYesterdayBtn").addEventListener("click", () => {
  loadGame(getTodayDateKey(-1));
});

// Challenge link logic (from your existing code)
function generateChallengeLink() {
  const today = getTodayDateKey();
  const url = new URL(window.location);
  url.searchParams.set("date", today);
  prompt("üîó Share this challenge link:", url.toString());
}

// Init
window.onload = () => {
  displayYesterday();
  loadGame();
};
</script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const howToPlayModal = document.getElementById("howToPlayModal");
    const howToPlayBtn = document.getElementById("howToPlayBtn");
    const closeHowToPlay = document.getElementById("closeHowToPlay");

    howToPlayBtn.addEventListener("click", function () {
      howToPlayModal.style.display = "block";
    });

    closeHowToPlay.addEventListener("click", function () {
      howToPlayModal.style.display = "none";
    });

    window.addEventListener("click", function (event) {
      if (event.target === howToPlayModal) {
        howToPlayModal.style.display = "none";
      }
    });
  });
</script>
  <script>
// Example integration spot
let solutionChain = ["cold", "cord", "card", "ward", "warm"];
let currentIndex = 0;
let score = 10;
let hintUsed = false;

document.getElementById("submit-word").addEventListener("click", () => {
  // Your existing submit logic...
});

document.getElementById("hint-btn").addEventListener("click", () => {
  if (hintUsed) {
    alert("You can only use one hint per game.");
    return;
  }
  if (currentIndex + 1 < solutionChain.length) {
    const nextWord = solutionChain[currentIndex + 1];
    document.getElementById("hint-output").textContent = `Hint: ${nextWord}`;
    currentIndex++;
    document.getElementById("word-chain").innerHTML += `<li>${nextWord}</li>`;
    score -= 3;
    document.getElementById("score").textContent = score;
    hintUsed = true;
  }
});
</script>


</body>
</html>
